// Generated by CoffeeScript 1.7.1
(function() {
  var TOKENS, announceResult, computerMove, drawBoard, gameOver, promptHandler, startPrompt, valid,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  TOKENS = {
    "0": " ",
    "-1": "X",
    "1": "O"
  };

  drawBoard = function(board) {
    var position;
    board = (function() {
      var _i, _len, _results;
      _results = [];
      for (_i = 0, _len = board.length; _i < _len; _i++) {
        position = board[_i];
        _results.push(TOKENS[position]);
      }
      return _results;
    })();
    return jqconsole.Write([[" " + board[0] + " | " + board[1] + " | " + board[2] + " \t 0 | 1 | 2 "], [" " + board[3] + " | " + board[4] + " | " + board[5] + " \t 3 | 4 | 5 "], [" " + board[6] + " | " + board[7] + " | " + board[8] + " \t 6 | 7 | 8 "]].join("\n---|---|---\t---|---|---\n") + "\n");
  };

  computerMove = function() {
    return tictactoe.occupy(tictactoe.alphaBetaSearch().pop());
  };

  valid = function(move) {
    return __indexOf.call(tictactoe.getFreePositions(), move) >= 0;
  };

  announceResult = function() {
    if (tictactoe.winner(1)) {
      return jqconsole.Write("You won!\n");
    } else if (tictactoe.loser(1)) {
      return jqconsole.Write("You lost.\n");
    } else {
      return jqconsole.Write("Draw.\n");
    }
  };

  gameOver = function() {
    return tictactoe.endState(1);
  };

  promptHandler = function(input) {
    var move;
    jqconsole.Clear();
    move = parseInt(input, 10);
    if (valid(move)) {
      tictactoe.occupy(move);
      computerMove();
    } else {
      jqconsole.Write("That's an illegal move. Try again.\n");
    }
    drawBoard(tictactoe.board());
    if (gameOver()) {
      announceResult();
      tictactoe.clear();
      return;
    }
    return startPrompt();
  };

  startPrompt = function() {
    return jqconsole.Prompt(true, promptHandler);
  };

  drawBoard(window.tictactoe.board());

  startPrompt();

}).call(this);
